<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pedidos de Galápagos</title>
    <style>
        :root {
            --primary: #2563eb;
            --success: #059669;
            --bg: #f1f5f9;
            --text: #1e293b;
        }

        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background-color: var(--bg);
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .container {
            width: 95%;
            max-width: 1000px;
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
        }

        h2 { color: #0f172a; border-left: 4px solid var(--primary); padding-left: 10px; margin-bottom: 20px; }
        
        textarea {
            width: 100%;
            height: 100px;
            padding: 12px;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            margin-bottom: 15px;
            font-size: 14px;
            background: #f8fafc;
        }
        
        .btn-group { margin-bottom: 20px; display: flex; gap: 10px; align-items: center; }

        button {
            padding: 10px 18px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            border: none;
            transition: 0.2s;
        }

        .btn-calc { background: var(--primary); color: white; }
        .btn-copy { background: #ecfdf5; color: var(--success); border: 1px solid #10b981; }
        .btn-clear { background: #f1f5f9; color: #64748b; }
        
        button:hover { opacity: 0.9; }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
            font-size: 14px;
        }
        
        th {
            background-color: #f8fafc;
            color: #64748b;
            padding: 12px;
            text-align: left;
            border-bottom: 2px solid #e2e8f0;
            text-transform: uppercase;
            font-size: 11px;
        }
        
        td { padding: 12px; border-bottom: 1px solid #f1f5f9; }

        .peso-col {
            font-weight: bold;
            color: var(--primary);
            text-align: right;
        }

        .total-row {
            background-color: #f8fafc !important;
            font-weight: 800;
        }

        .total-label {
            text-align: right;
            color: #475569;
        }

        #copyStatus { color: var(--success); font-size: 0.85rem; font-weight: bold; display: none; }
    </style>
</head>
<body>

<div class="container">
    <h2>Detalle de información de los pedidos ℹ️</h2>
    
    <textarea id="dataInput" placeholder="Pega aquí la base de datos..."></textarea>
    
    <div class="btn-group">
        <button class="btn-calc" onclick="procesarPesos()">Procesar información</button>
        <button class="btn-copy" onclick="copiarTabla()">Copiar información</button>
        <button class="btn-clear" onclick="limpiar()">Limpiar</button>
        <span id="copyStatus">¡Copiado!</span>
    </div>

    <table id="tablaPesos">
        <thead>
            <tr>
                <th>BARRIO</th>
                <th>NO GUIA</th>
                <th>COD DISTR.</th>
                <th>NOMBRE DESTINATARIO</th>
                <th style="text-align: right;">PESO</th>
            </tr>
        </thead>
        <tbody id="tableBody"></tbody>
        <tfoot id="tableFoot"></tfoot>
    </table>
</div>

<script>
    function procesarPesos() {
        const input = document.getElementById('dataInput').value;
        const tableBody = document.getElementById('tableBody');
        const tableFoot = document.getElementById('tableFoot');
        
        tableBody.innerHTML = '';
        tableFoot.innerHTML = '';

        if (!input.trim()) return;

        // Separamos las filas
        const filasOriginales = input.split(/\r?\n/);
        
        // Omitimos la primera fila (encabezado) usando slice(1)
        const filas = filasOriginales.slice(1);
        
        let datosArray = [];
        let sumaPesoTotal = 0;

        filas.forEach(fila => {
            if (fila.trim() === '') return;
            const columnas = fila.split('\t');
            
            const barrio = columnas[5] !== undefined ? columnas[5].trim() : '';
            const guia = columnas[0] !== undefined ? columnas[0].trim() : '';
            const codDistr = columnas[2] !== undefined ? columnas[2].trim() : '';
            const nombre = columnas[3] !== undefined ? columnas[3].trim() : '';
            const pesoTexto = columnas[11] !== undefined ? columnas[11].trim() : '0';

            let numeroLimpio = pesoTexto.replace(',', '.').replace(/[^0-9.]/g, "");
            let pesoValor = parseFloat(numeroLimpio) || 0;

            datosArray.push({ barrio, guia, codDistr, nombre, peso: pesoValor });
        });

        datosArray.sort((a, b) => a.barrio.localeCompare(b.barrio));

        datosArray.forEach(dato => {
            const tr = document.createElement('tr');
            sumaPesoTotal += dato.peso;

            tr.innerHTML = `
                <td>${dato.barrio}</td>
                <td>${dato.guia}</td>
                <td>${dato.codDistr}</td>
                <td>${dato.nombre}</td>
                <td class="peso-col">${dato.peso.toFixed(2)}</td>
            `;
            tableBody.appendChild(tr);
        });

        if (tableBody.rows.length > 0) {
            const footerTr = document.createElement('tr');
            footerTr.className = 'total-row';
            footerTr.innerHTML = `
                <td colspan="3" style="color: #94a3b8">Pedidos: ${tableBody.rows.length}</td>
                <td class="total-label">Total general:</td>
                <td class="peso-col" style="font-size: 16px; border-top: 2px solid #cbd5e1;">
                    ${sumaPesoTotal.toFixed(2)}
                </td>
            `;
            tableFoot.appendChild(footerTr);
        }
    }

    async function copiarTabla() {
        const tabla = document.getElementById('tablaPesos');
        if (tabla.rows.length <= 1) return;

        let texto = "";
        for (let row of tabla.rows) {
            let filaTexto = [];
            for (let cell of row.cells) {
                filaTexto.push(cell.innerText);
            }
            texto += filaTexto.join("\t") + "\n";
        }

        try {
            await navigator.clipboard.writeText(texto);
            const status = document.getElementById('copyStatus');
            status.style.display = 'inline';
            setTimeout(() => status.style.display = 'none', 2000);
        } catch (err) {
            alert('Error al copiar');
        }
    }

    function limpiar() {
        document.getElementById('dataInput').value = '';
        document.getElementById('tableBody').innerHTML = '';
        document.getElementById('tableFoot').innerHTML = '';
    }
</script>

</body>
</html>